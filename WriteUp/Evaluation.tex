\documentclass[12pt]{article}
\usepackage{amssymb,amsmath,latexsym, verbatim}
\usepackage{tikz,listings,url}
\usepackage{mathtools}
\usepackage{float}
\usepackage[margin=0.5in]{geometry}
%\usepackage{hyperref}
\usetikzlibrary{matrix,shapes,arrows,positioning,chains, calc}

\lstset{basicstyle=\bfseries\small}

\newcommand{\nbar}{\overline{n}}
\newcommand{\mbar}{\overline{m}}

\begin{document}
\title{Evaluation of LWE Key Exchange Protocol}
\maketitle

\section{Asymptotics}
\begin{center}
    \begin{tabular}{| l | l |}
    \hline
Server work & $O(n^2\nbar)$\\ \hline
Client work & $O(n^2\mbar)$\\ \hline
Client downloads & $O(n \nbar)$\\ \hline
Client uploads & $O(n \mbar)$\\ \hline
    \end{tabular}
\end{center}

\section{First round of evaluations}
\subsection{RLWE \tiny{(RLWE-RSA-AES128-GCM-SHA256)}}

\footnotesize{\textbf{keygen:} sampling $s(')$, $e(')$ and computing $b(') = as(') + e(')$\\
\textbf{Client shared:} sampling $e''$, computing $v = s'b + e''$, $c = \langle v \rangle_2$, $k = \lfloor v \rceil_2$\\
\textbf{Server shared:} computing $k = rec(b's, c)$}\\

RLWE (128 bits security, deriving 1024 bits key)
\begin{center}
    \begin{tabular}{| l | l | l |}
    \hline
    keygen & Client shared & Server shared \\ \hline
    0.674ms & 0.402ms & 0.119ms  \\ \hline
    \end{tabular}
\end{center}

TSH protocol transcript:
\begin{center}
    \begin{tabular}{| l | l | l |}
    \hline
    $\leftarrow$ ClientHello & 94B & 0x005e\\ \hline
    $\rightarrow$ ServerHello & 58B & 0x003a\\ \hline
    $\rightarrow$ Certificate & 594B & 0x0252\\ \hline
    \textcolor{red}{$\rightarrow$ ServerKeyExchange} & \textcolor{red}{4234B = 4KiB} & 0x108a\\ \hline
    $\rightarrow$ ServerHelloDone & 4B & 0x4\\ \hline
    \textcolor{red}{$\leftarrow$ ClientKeyExchange} & \textcolor{red}{4232B = 4KiB} & 0x1088\\ \hline
    $\leftarrow$ ChangeCipherSpec & 1B & 0x1\\ \hline
    $\leftarrow$ Finished & 16B & 0x10\\ \hline
    $\rightarrow$ Session Ticket & 170B & 0x00aa\\ \hline
    $\rightarrow$ ChangeCipherSpec & 1B & 0x1\\ \hline
    $\rightarrow$ Finished & 16B & 0x10\\ \hline
    \end{tabular}
\end{center}

\subsection{LWE \tiny{(LWE-RSA-AES128-GCM-SHA256)}}

\footnotesize{\textbf{Server keygen:} sampling $S$, $E$ and computing $B = AS + E$\\
\textbf{Client keygen:} sampling $S'$, $E'$ and computing $B' = S'A + E'$\\
\textbf{Client shared:} sampling $E''$, computing $V = S'B + E''$, $C = \langle V \rangle_2$, $K = \lfloor V \rceil_2$\\
\textbf{Server shared:} computing $K = rec(B'S, C)$\\}

LWE (128 bits security, deriving $128 = \nbar \mbar$ bits key)
\begin{center}
    \begin{tabular}{| l | l | l | l |}
    \hline
    Server keygen & Client keygen & Client shared & Server shared \\ \hline
    15.7ms & 29.5ms & 0.2ms & 0.1ms \\ \hline
    \multicolumn{4}{c}{Store and use $A^T$ in generating client's key:} \\ \hline
    15.9s &   \textcolor{red}{14.9ms} &   0.147ms &   0.119ms \\ \hline
    \end{tabular}
\end{center}
About 20 X slowdown in key generation compared to RLWE, the rest is comparable.

TSH protocol transcript:
\begin{center}
    \begin{tabular}{| l | l | l |}
    \hline
    $\leftarrow$ ClientHello & 94B & 0x005e\\ \hline
    $\rightarrow$ ServerHello & 58B & 0x003a\\ \hline
    $\rightarrow$ Certificate & 594B & 0x0252\\ \hline
    \textcolor{red}{$\rightarrow$ ServerKeyExchange} & \textcolor{red}{49290B = 48KiB} & 0xc08a\\ \hline
    $\rightarrow$ ServerHelloDone & 4B & 0x4\\ \hline
    \textcolor{red}{$\leftarrow$ ClientKeyExchange} & \textcolor{red}{49176B = 48KiB} & 0xc018\\ \hline
    $\leftarrow$ ChangeCipherSpec & 1B & 0x1\\ \hline
    $\leftarrow$ Finished & 16B & 0x10\\ \hline
    $\rightarrow$ Session Ticket & 170B & 0x00aa\\ \hline
    $\rightarrow$ ChangeCipherSpec & 1B & 0x1\\ \hline
    $\rightarrow$ Finished & 16B & 0x10\\ \hline
    \end{tabular}
\end{center}

\subsection{Better reconciliation mechanism}
See pencil notes, if $i$ bits are extracted from a single element in $Z_q$, then the probability for the two parties to fail the handshake (to end up with different keys) would be bounded from above by the following expression:
\begin{align*}
\mbar \cdot \nbar \cdot (4n) \exp\left(-\frac{q}{2^{3 + i} \cdot (2n) \sigma^2}\right)
\end{align*}

Since everything scales proportionally to $\mbar$ and $\nbar$, we can draw the following estimates (for now we assume $\nbar = \mbar$):
% formula used to calculate the exponent in the second column: (-2^(18 - i)/3.2/3.2 + ln(2^19 - i)) * log(e)
\begin{center}
    \begin{tabular}{|p{3cm}| c | c | c | c |}
    \hline
    Bits extracted from one ring element ($i$) & Probability of failure & $\nbar = \mbar = \sqrt{\frac{128}{i}}$ & Server/Client keygen (ms) & Client upload/download (KiB)\\ \hline
    1 & 1e-5553 & 12 & 16 & 48\\ \hline
    2 & 1e-2773 & 8 & 24 & 72\\ \hline
    3 & 1e-1384 & 7 & 27 & 82\\ \hline
    4 & 1e-689 & 6 & 32 & 96\\ \hline
    5 & 1e-341 & 5 & 38 & 115\\ \hline
    6 & 1e-167 & 5 & 38 & 115\\ \hline
    7 & 1e-81 & 5 & 38 & 115\\ \hline
    8 & 1e-37 & 4 & 48 & 144\\ \hline
    9 & 1e-15 & 4 & 48 & 144\\ \hline
    10 & 1e-5 & 4 & 48 & 144\\ \hline
    11 & ~1 & 4 & 48 & 144\\ \hline
    \end{tabular}
\end{center}

Trying out to extract 16bits, failed handshakes: .

\end{document}
